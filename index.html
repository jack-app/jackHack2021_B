<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>Firestoreチャット</title>
</head>

<body>

<h1>Firestoreチャット</h1>

<!--
<div id="messages">@messages</div>
<div class="chat-form">
  <input type="text">
  <input type="submit" value="送信">
</div>
-->

    <!-- 発言フォーム -->
    <form id="frm-post">
        <input type="text" id="msg">
        <button type="button" id="btn_id">送信</button>
    </form>

    <!-- 発言ログ -->
    <ul id="msglist">
    </ul>
    <div class="card-container"></div>
    <a href="http://www.goo.ne.jp/">
        <img src="//u.xgoo.jp/img/sgoo.png" alt="supported by goo" title="supported by goo" width="100">
    </a>
    <script src="https://code.jquery.com/jquery-3.0.0.min.js"></script>
    <script src="haiku.js"></script>
    <script src="watson.js"></script>

<script src="/socket.io/socket.io.js"></script>
<script>
  //-------------------------------------
  // Socket.ioサーバへ接続
  //-------------------------------------
  const socket = io();
  /**
   * [イベント] フォームが送信された
   */

  async function postHaiku(msg) {
    var haiku = await parce(msg.value);
    console.log(haiku);
    if (haiku != null) {
      // Socket.ioサーバへ送信
      socket.emit("post", {text: haiku});
      // 発言フォームを空にする
      msg.value = "";
    }else{
      alert("この文は575ではありません")
    };
  };

  document.querySelector("#frm-post").addEventListener("submit", (e)=>{
    // 規定の送信処理をキャンセル(画面遷移しないなど)
    e.preventDefault();

    // 入力内容を取得する
    const msg = document.querySelector("#msg");
    if( msg.value === "" ){
      return(false);
    }
    postHaiku(msg);
  });

        /**
         * [イベント] 誰かが発言した
         */
        socket.on("member-post", (msg) => {
            replace(msg.text['haiku']);
            // const list = document.querySelector("#msglist");
            // const cardContainer = document.createElement("div");
            // cardContainer.innerHTML = `${msg.text['haiku']}`;
            // list.insertBefore(li, list.firstChild);
        });

        /**
         * [イベント] ページの読込み完了
         */
        window.onload = () => {
            // テキストボックスを選択する
            document.querySelector("#msg").focus();
        }


    </script>
</body>

</html>